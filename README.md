# TDW Multi-Modal Challenge

Search for a dropped object in a room using the [Magnebot API](https://github.com/alters-mit/magnebot) and pre-calculated audio that was generated by a physics simulation of the falling object.

# Setup

1. `git clone https://github.com/alters-mit/multimodal_challenge.git`
2. `cd path/to/multimodal_challenge` (replace `path/to` with the actual path)
3. `pip3 install -e .`
4. (Optional) Download the asset bundles (see **Environment variables** below).

# `MultiModal` challenge controller

Use a `MultiModal` controller to initialize a scene, populate it with objects (including the target object), and load the corresponding audio data.

**[Read the API documentation.](doc/api/multimodal.md)**

```python
from multimodal_challenge.multimodal import MultiModal

m = MultiModal()
m.init_scene(scene="mm_kitchen_1a", layout=0, trial=57)
```

# Audio Dataset Generation

![](doc/images/dataset.png)

## `init_data.py`

This is a backend tool for TDW  developers to convert saved [TDW commands](https://github.com/threedworld-mit/tdw/blob/master/Documentation/api/command_api.md) into [initialization instructions](doc/api/multimodal_object_init_data.md). It will also create [metadata records](https://github.com/threedworld-mit/tdw/blob/master/Documentation/python/librarian/librarian.md), [`DropZone`](doc/api/drop_zone.md) data, and occupancy maps.

[Further documentation here.](doc/dataset/init_data.md)

## `rehearsal.py`

Define [`DatasetTrial`](doc/api/dataset_trial.md) initialization parameters for target objects. Drop the object. If it lands in a [`DropZone`](doc/api/drop_zone.md), record the `DatasetTrial`. This will give `dataset.py` initialization parameters.

[Further documentation here.](doc/dataset/rehearsal.md)

## `dataset.py`

Use the initialization data generated by `rehearsal.py` to create [`Trials`](doc/api/trial.md). A `Trial` is initialization data for each object in the scene (position, rotation, etc.), initialization data for the Magenbot, and a .wav file.

[Further documentation here.](doc/dataset/dataset.md)

# Environment variables

Each component script of the audio dataset generation process (`init_data.py`, `rehearsal.py`, and `dataset.py`) have two optional environment variables: `MULTIMODAL_ASSET_BUNDLES` and `MULTIMODAL_DATASET`. To set these values:

#### 1. `MULTIMODAL_ASSET_BUNDLES`

**The root directory to download scenes and asset bundles from.** Default value: `"https://tdw-public.s3.amazonaws.com"`  

Every scene (room environment) and model (furniture, cabinets, cups, etc.) is stored in TDW as an [asset bundle](https://docs.unity3d.com/Manual/AssetBundlesIntro.html). These asset bundles are downloaded at runtime from a remote S3 server, but it is possible to download them *before* run time and load them locally. **If your Internet connection will make it difficult/slow/impossible to download large US-based files at runtime, we strongly suggest you download them locally.** To do this:

1. `cd path/to/multimodal_challenge`
2. `python3 download.py --dst [DST]`. The `--dst` argument sets the root download directory. Example: `python3 download.py --dst /home/mm_asset_bundles`.

#### 2. `MULTIMODAL_DATASET`

**The path to the dataset files.** Default value: `"D:/multimodal_challenge"`

In `rehearsal.py` and `dataset.py` this is where the files will be saved. In a `MultiModal` controller, this is the expected location from where the trial files will be loaded. 

#### How to set the environment variables

Replace `[asset_bundles]` and `[dataset]` with the actual paths. For example: `export MULTIMODAL_ASSET_BUNDLES=/home/mm_asset_bundles`.

| Platform             | Command                                                      |
| -------------------- | ------------------------------------------------------------ |
| OS X or Linux        | `export MULTIMODAL_ASSET_BUNDLES=[asset_bundles] && export MULTIMODAL_DATASET=[dataset] && python3 my_controller.py` |
| Windows (cmd)        | `set MULTIMODAL_ASSET_BUNDLES=[asset_bundles] && set MULTIMODAL_DATASET=[dataset] && py -3 my_controller.py` |
| Windows (powershell) | `$env:MULTIMODAL_ASSET_BUNDLES="[asset_bundles]" ; $env:MULTIMODAL_DATASET="[dataset]" ; py -3 my_controller.py` |

# Changelog

[Changelog](doc/changelog.md)